{% load static %}
<!DOCTYPE html>

<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

<title>Anbu cabs | best cab servise in chennai</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<link rel="stylesheet" href="{% static 'css/index.css' %}"/>

<style>
    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
    }

    input[type="radio"]:checked {
        background-color: #f4e225;
        border-color: #f4e225;
    }

    /* Suggestions List */
    ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>

</head>

<body class="bg-background-light dark:bg-background-dark text-white min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-background-dark/80 backdrop-blur-md border-b border-border-dark px-4 py-3">
<div class="max-w-7xl mx-auto flex items-center justify-between">
<div class="flex items-center gap-2">
<div class="bg-primary p-1.5 rounded-lg flex items-center justify-center">
<span class="material-symbols-outlined text-black font-bold">local_taxi</span>
</div>
<h1 class="text-xl font-extrabold tracking-tight text-white uppercase italic">
Yellow<span class="text-primary">Cab</span>
</h1>
</div>

<a class="flex items-center gap-2 text-primary font-bold hover:opacity-80 transition-opacity" href="tel:9940395607">
<span class="material-symbols-outlined">call</span>
<span class="hidden sm:inline">9940395607</span>
</a>
</div>
</header>

<main class="max-w-4xl mx-auto px-4 py-8 sm:py-12">

<!-- HERO -->
<section class="text-center mb-10">
<h2 class="text-4xl sm:text-5xl font-black mb-4 leading-tight">
Book Your Ride <span class="text-primary italic">Instantly</span>
</h2>
<p class="text-text-muted text-lg max-w-xl mx-auto">
Reliable taxis at your doorstep 24/7. Professional drivers, modern fleet, and competitive rates.
</p>
</section>

<!-- FORM CARD -->
<div class="bg-surface-dark border border-border-dark rounded-xl p-6 sm:p-8 shadow-2xl relative overflow-hidden">
<div class="absolute top-0 left-0 w-full h-1 bg-primary"></div>

<h3 class="text-2xl font-bold mb-6">Reservation Details</h3>

<form class="grid grid-cols-1 md:grid-cols-2 gap-6" onsubmit="event.preventDefault();">

<!-- NAME -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Full Name</label>
<input class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="name" placeholder="John Doe" type="text"/>
</div>

<!-- MOBILE -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Mobile Number</label>
<input class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="mobile" placeholder="9940395607" type="tel"/>
</div>

<!-- PICKUP -->
<div class="flex flex-col gap-2">
  <label class="text-sm font-semibold text-text-muted">Pickup Location</label>

  <input
    class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
    id="pickup"
    list="pickupList"
    placeholder="Current Location"
    type="text"
  />

  <!-- Pickup Suggestions -->
  <datalist id="pickupList"></datalist>
</div>



<!-- DROP -->

<div class="flex flex-col gap-2">
  <label class="text-sm font-semibold text-text-muted">Destination</label>

  <input
    class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
    id="drop"
    list="dropList"
    placeholder="Where to?"
    type="text"
  />

  <!-- Drop Suggestions -->
  <datalist id="dropList"></datalist>
</div>



<!-- DATE -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Date</label>
<input class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="date" type="date" required/>
</div>

<!-- TIME -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Time</label>
<input class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="time" type="time" required/>
</div>

<!-- TRIP TYPE -->
<div class="flex flex-col gap-2 md:col-span-2">
<label class="text-sm font-semibold text-text-muted">Trip Type</label>
<div class="flex gap-4">
<label>
<input checked name="tripType" type="radio" value="One Way"/> One Way
</label>
<label>
<input name="tripType" type="radio" value="Up and Down"/> Up and Down
</label>
</div>
</div>

<!-- MEMBERS -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Passengers</label>
<input class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="members" min="1" max="15" type="number" value="1"/>
</div>

<!-- CAR MODEL -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-text-muted">Car Model</label>
<select class="w-full bg-background-dark border border-border-dark rounded-lg py-3 px-4 text-white"
id="carModel">
<option value="Mini">Mini</option>
<option selected value="Sedan">Sedan</option>
<option value="SUV">SUV</option>
<option value="Premium">Premium</option>
</select>
</div>

<!-- BUTTON -->
<div class="md:col-span-2 mt-4">
<button class="w-full bg-primary text-black font-extrabold text-lg py-4 rounded-lg"
onclick="sendWhatsApp()" type="button">
Book Taxi Now
</button>
</div>

</form>
</div>

</main>

<!-- âœ… FULL SCRIPT -->
<script>
    // -------------------------------
    // 1) AUTOCOMPLETE (Nominatim API)
    // -------------------------------
    async function getSuggestions(inputId, listId) {
        let query = document.getElementById(inputId).value;

        if (query.length < 3) return;

        let url = `https://nominatim.openstreetmap.org/search?format=json&q=${query}`;

        let response = await fetch(url);
        let data = await response.json();

        let datalist = document.getElementById(listId);
        datalist.innerHTML = "";

        data.slice(0, 5).forEach(place => {
            let option = document.createElement("option");
            option.value = place.display_name;
            datalist.appendChild(option);
        });
    }

    // -------------------------------
    // 2) GET COORDINATES
    // -------------------------------
    async function getCoordinates(place) {

        let url = `https://nominatim.openstreetmap.org/search?format=json&q=${place}`;

        let response = await fetch(url);
        let data = await response.json();

        if (data.length === 0) return null;

        return {
            lat: parseFloat(data[0].lat),
            lon: parseFloat(data[0].lon)
        };
    }

    // -------------------------------
    // 3) DISTANCE CALCULATION (KM)
    // -------------------------------
    function calculateDistance(lat1, lon1, lat2, lon2) {

        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;

        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) *
            Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);

        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return (R * c).toFixed(2);
    }

    // -------------------------------
    // 4) SEND WHATSAPP MESSAGE
    // -------------------------------
    async function sendWhatsApp() {

        const name = document.getElementById("name").value;
        const mobile = document.getElementById("mobile").value;
        const pickup = document.getElementById("pickup").value;
        const drop = document.getElementById("drop").value;
        const tripType = document.querySelector("input[name='tripType']:checked").value;
        const members = document.getElementById("members").value;
        const carModel = document.getElementById("carModel").value;
        const date = document.getElementById("date").value;
        const time = document.getElementById("time").value;

        if (!name || !mobile || !pickup || !drop) {
            alert("Please fill all details!");
            return;
        }

        // Coordinates
        let pickupCoords = await getCoordinates(pickup);
        let dropCoords = await getCoordinates(drop);

        if (!pickupCoords || !dropCoords) {
            alert("Invalid location. Please select from suggestions.");
            return;
        }

        // Distance
        let distance = calculateDistance(
            pickupCoords.lat,
            pickupCoords.lon,
            dropCoords.lat,
            dropCoords.lon
        );

        // Message
        const message =
            `ðŸš– *Taxi Booking Request* \n\n` +
            `*Name:* ${name}\n` +
            `*Mobile:* ${mobile}\n` +
            `*Pickup:* ${pickup}\n` +
            `*Drop:* ${drop}\n` +
            `*Distance:* ${distance} KM\n` +
            `*Trip Type:* ${tripType}\n` +
            `*Passengers:* ${members}\n` +
            `*Date:* ${date}\n` +
            `*Time:* ${time}\n` +
            `*Car Model:* ${carModel}`;

        let whatsappUrl =
            `https://wa.me/919940395607?text=${encodeURIComponent(message)}`;

        window.open(whatsappUrl, "_blank");
    }

    // -------------------------------
    // 5) INPUT EVENTS
    // -------------------------------
    document.getElementById("pickup").addEventListener("input", function () {
        getSuggestions("pickup", "pickupList");
    });

    document.getElementById("drop").addEventListener("input", function () {
        getSuggestions("drop", "dropList");
    });
</script>



</body>
</html>
